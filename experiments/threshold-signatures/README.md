# Experiment: Threshold Signatures Alternative

> **Branch**: `feature/threshold-signatures-alternative`
> **Status**: BLOCKED - Opcode 252 still present
> **Date**: 2026-02-04

---

## Result: DOES NOT AVOID OPCODE 252

### Findings

```
Wasm Contract: linera_threshold_multisig.wasm
Size: ~292 KB
Opcode 252 (memory.copy): 73 instances detected
Compilation: Successful
Deploy: WOULD FAIL on Linera testnet
```

### Analysis

Even with an **extremely simplified contract** that:

- Does NOT cryptographically verify signatures (ed25519-dalek removed)
- Does NOT have complex proposal logic
- Does NOT use GraphQL for operations
- Only maintains basic state (owners, threshold, nonce, aggregate_key)

The Wasm bytecode **STILL CONTAINS** opcode 252 (`memory.copy`).

### Root Cause

The problem is **NOT in our contract code**. Opcode 252 is generated by `linera-sdk` dependencies:

```
linera-sdk 0.15.11
     async-graphql = "=7.0.17" (version pin)
         requires Rust 1.87+ (for let-chain syntax)
             generates memory.copy (opcode 252)
                 Linera runtime does NOT support it
```

**Even when using `async-graphql` only for the ABI** (without GraphQL operations), the bytecode generated by linera-sdk includes opcode 252.

---

## Tests Performed

### 1. Compilation

```bash
cargo build --release --target wasm32-unknown-unknown
```

**Result**: Successful
- Wasm generated: `linera_threshold_multisig.wasm` (~292 KB)

### 2. Opcode 252 Verification

```bash
wasm-objdump -d linera_threshold_multisig.wasm | grep "memory.copy"
```

**Result**: 73 instances of `memory.copy` found

```wasm
004569: fc 0a 00 00    | memory.copy 0 0
00486a: fc 0a 00 00    | memory.copy 0 0
008171: fc 0a 00 00    | memory.copy 0 0
...
```

### 3. Dependency Analysis

```bash
cargo tree | grep async-graphql
```

```
linera-threshold-multisig v0.1.0
 linera-sdk v0.15.11
     async-graphql v7.0.17
```

**Confirms**: `async-graphql = "=7.0.17"` is a mandatory transitive dependency of `linera-sdk`.

---

## Conclusions

### Threshold Signatures is NOT a Viable Solution

The threshold signatures approach **CANNOT avoid** opcode 252 because:

1. **The problem is not our code**: Even a minimal contract contains the opcode
2. **The problem is linera-sdk**: The `async-graphql = "=7.0.17"` dependency is mandatory
3. **No workaround is possible**: Any contract using `linera-sdk` will have opcode 252

### Comparison with Original Architecture

| Aspect | Original (blocked) | Threshold (this) |
|---------|---------------------|-------------------|
| **Contract Logic** | Proposal state machine | Threshold signatures |
| **Complexity** | High | Very low |
| **async-graphql** | Used (operations) | Used (ABI only) |
| **Opcode 252** | Present | **Present** |
| **Result** | Won't deploy | **Won't deploy** |

### Same Root Cause, Same Conclusion

Both approaches are **blocked by the same linera-sdk ecosystem problem**.

---

## Implications

### For This Project

1. **No Wasm contract solution exists** while `linera-sdk 0.15.x` has `async-graphql = "=7.0.17"`
2. **Threshold signatures is NOT the answer** - the problem is deeper
3. **Solution requires Linera team action** - issue #4742

### For Development

**Remaining Options**:

1. **Wait for Linera SDK** - Recommended, but without timeline
   - Issue: https://github.com/linera-io/linera-protocol/issues/4742

2. **Use only multi-owner chains** - Self-custodial but 1-of-N
   - Any owner can execute without approvals
   - NOT a Safe-type multisig

---

## Experiment Files

```
experiments/threshold-signatures/
 Cargo.toml                  # Configuration
 README.md                   # This file
 docs/
    ARCHITECTURE.md         # Detailed technical architecture
 src/
     lib.rs                  # Simplified Wasm contract
     state.rs                # Contract state
     operations.rs           # Operations
```

---

## Next Steps

### Immediate

1. Document results in README.md
2. Commit to branch `feature/threshold-signatures-alternative`
3. Report findings to user

### For Main Repository

1. Update `docs/INFRASTRUCTURE_ANALYSIS.md` with these findings
2. Add section on "Attempted Alternative Approaches"
3. Keep status as "BLOCKED" until Linera team resolution

---

## References

- **Original Opcode 252 Analysis**: `docs/research/LINERA_OPCODE_252_ISSUE.md`
- **Linera SDK Issue**: https://github.com/linera-io/linera-protocol/issues/4742
- **Branch**: `feature/threshold-signatures-alternative`

---

**Last updated**: 2026-02-04
**Conclusion**: Threshold signatures is **NOT a viable solution** for opcode 252.
